plugins {
    id "java"
}

sourceCompatibility = 13
targetCompatibility = 8

compileJava {
    options.compilerArgs = [
            "--release", "8",
    ]
}

compileTestJava {
    options.compilerArgs = [
            "--release", "8",
    ]
}

test {
    doFirst {
        def javaVersion = System.getProperty("java.version").tokenize(".").get(0).toInteger()
        if (javaVersion != 13) {
            throw new IllegalStateException("Must run build on Java 13 (system reported: ${javaVersion})")
        }

        def java8home = System.getenv("JAVA_HOME_8")
        if (!java8home) {
            throw new IllegalStateException("JAVA_HOME_8 must be set")
        }
        executable = "$java8home/bin/java"
    }
}

dependencies {
    annotationProcessor project(":jabel-javac-plugin")

    testCompile 'junit:junit:4.12'
}